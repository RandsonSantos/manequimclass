{% extends 'base.html' %}

{% block title %}
{% if cliente %}Cliente: {{ cliente.nome }}{% else %}Cliente{% endif %}
{% endblock %}

{% block content %}
<div class="container" style="max-width: 700px;">
  {% if cliente %}
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h3>Cliente: {{ cliente.nome }}</h3>
    <a href="{{ url_for('editar_cliente', cliente_id=cliente.id) }}" class="btn btn-outline-primary">
      <i class="bi bi-pencil"></i> Editar
    </a>
  </div>

  <div class="mb-4">
    <p><strong>Telefone:</strong> {{ cliente.telefone }}</p>
    <p><strong>Cidade:</strong> {{ cliente.cidade or '—' }}</p>
    <p><strong>Endereço:</strong> {{ cliente.endereco or '—' }}</p>
    <p><strong>CPF/CNPJ:</strong> {{ cliente.cpf_cnpj or '—' }}</p>

    {% set mensagem = "Olá " ~ cliente.nome ~ ", tudo bem? Aqui é da Manequim Class. Qualquer dúvida, estamos à disposição!" %}
    <a href="https://wa.me/55{{ cliente.telefone | replace(' ', '') }}?text={{ mensagem | urlencode }}" target="_blank" class="btn btn-success mt-2">
      <i class="bi bi-whatsapp"></i> Enviar WhatsApp
    </a>
  </div>

  <h5 class="mb-3">Pedidos Realizados</h5>
  {% if pedidos %}
  <form method="get" class="mb-3">
    <input type="hidden" name="cliente_id" value="{{ cliente.id }}">
    <label for="status" class="form-label">Filtrar por status:</label>
    <select name="status" id="status" class="form-select" onchange="this.form.submit()">
      <option value="">Todos</option>
      <option value="confirmado" {% if status == 'confirmado' %}selected{% endif %}>Confirmado</option>
      <option value="pendente" {% if status == 'pendente' %}selected{% endif %}>Pendente</option>
      <option value="cancelado" {% if status == 'cancelado' %}selected{% endif %}>Cancelado</option>
    </select>
  </form>
  
  <table class="table table-sm table-bordered align-middle">
    <thead class="table-light">
      <tr>
        <th>Item</th>
        <th>Evento</th>
        <th>Status</th>
        <th>Ações</th>
      </tr>
    </thead>
    <tbody>
      {% for pedido in pedidos %}
      <tr>
        <td>{{ pedido.item.nome }} ({{ pedido.item.modelo }})</td>
        <td>{{ pedido.data_evento.strftime('%d/%m/%Y') }}</td>
        <td>
          {% if pedido.cancelado %}
            <span class="badge bg-danger">Cancelado</span>
          {% elif pedido.confirmado %}
            <span class="badge bg-success">Confirmado</span>
          {% else %}
            <span class="badge bg-warning text-dark">Pendente</span>
          {% endif %}
        </td>
        <td>
          <a href="{{ url_for('ver_pedido', pedido_id=pedido.id) }}" class="btn btn-sm btn-outline-secondary" title="Ver Pedido">
            <i class="bi bi-eye"></i>
          </a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
    <div class="alert alert-info">Este cliente ainda não possui pedidos registrados.</div>
  {% endif %}

  <div class="mt-4 text-end">
    <a href="javascript:history.back()" class="btn btn-outline-dark">
      <i class="bi bi-arrow-left"></i> Voltar
    </a>
  </div>

  {% else %}
    <div class="alert alert-danger">Cliente não encontrado.</div>
  {% endif %}
</div>
{% endblock %}
