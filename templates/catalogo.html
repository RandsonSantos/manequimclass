{% extends 'base.html' %}
{% block title %}Catálogo por Categoria{% endblock %}

{% block content %}
<h2 class="mb-5 text-center fw-bold text-uppercase">Catálogo por Categoria</h2>

<div class="row">
  {% for categoria, item in destaques.items() %}
    <div class="col-xl-3 col-lg-4 col-md-6 col-sm-12 mb-4">
      <a href="{{ url_for('categoria', categoria=categoria) }}" class="text-decoration-none">
        <div class="card h-100 shadow-sm border-0 rounded-4 text-center">
          <div id="carouselCategoria{{ loop.index }}" class="carousel slide" data-bs-ride="carousel">
            
            {% if item and item.imagens and item.imagens|length > 1 %}
              <div class="carousel-indicators">
                {% for imagem in item.imagens %}
                  <button type="button"
                          data-bs-target="#carouselCategoria{{ loop.parent.index }}"
                          data-bs-slide-to="{{ loop.index0 }}"
                          class="{% if loop.first %}active{% endif %}"
                          {% if loop.first %}aria-current="true"{% endif %}
                          aria-label="Slide {{ loop.index }}">
                  </button>
                {% endfor %}
              </div>
            {% endif %}

            <div class="carousel-inner rounded-top">
              {% if item and item.imagens %}
                {% for imagem in item.imagens %}
                  <div class="carousel-item {% if loop.first %}active{% endif %}">
                    <img src="{{ url_for('static', filename='images/' ~ imagem.caminho) }}"
                         class="d-block w-100 card-img-top img-hover"
                         alt="Imagem da categoria {{ categoria }}"
                         loading="lazy">
                  </div>
                {% endfor %}
              {% else %}
                <div class="carousel-item active">
                  <img src="{{ url_for('static', filename='images/default.jpg') }}"
                       class="d-block w-100 card-img-top img-hover"
                       alt="Imagem padrão"
                       loading="lazy">
                </div>
              {% endif %}
            </div>

            {% if item and item.imagens and item.imagens|length > 1 %}
              <button class="carousel-control-prev" type="button" data-bs-target="#carouselCategoria{{ loop.index }}" data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Anterior</span>
              </button>
              <button class="carousel-control-next" type="button" data-bs-target="#carouselCategoria{{ loop.index }}" data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Próximo</span>
              </button>
            {% endif %}
          </div>

          <div class="card-body">
            <h5 class="card-title text-capitalize">{{ categoria }}</h5>
            <p class="card-text text-muted">Ver todos os itens</p>
            {% if item.quantidade %}
              <p class="small text-secondary">{{ item.quantidade }} itens disponíveis</p>
            {% endif %}
          </div>
        </div>
      </a>
    </div>
  {% endfor %}
</div>

<style>
  .img-hover {
    transition: transform 0.3s ease;
  }
  .img-hover:hover {
    transform: scale(1.05);
  }
</style>
{% endblock %}
