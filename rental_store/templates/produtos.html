{% extends 'base.html' %}
{% block title %}Produtos{% endblock %}

{% block content %}
<h2 class="mb-4 text-center fw-bold text-uppercase">Todos os Produtos</h2>

<form method="GET" action="{{ url_for('produtos') }}" class="row mb-5">
  <div class="col-md-4">
    <select name="tipo" class="form-select">
      <option value="">Tipo</option>
      <option value="aluguel" {% if request.args.get('tipo') == 'aluguel' %}selected{% endif %}>Aluguel</option>
      <option value="venda" {% if request.args.get('tipo') == 'venda' %}selected{% endif %}>Venda</option>
    </select>
  </div>
  <div class="col-md-4">
    <select name="modelo" class="form-select">
      <option value="">Modelo</option>
      <option value="vestido" {% if request.args.get('modelo') == 'vestido' %}selected{% endif %}>Vestido</option>
      <option value="traje" {% if request.args.get('modelo') == 'traje' %}selected{% endif %}>Traje</option>
    </select>
  </div>
  <div class="col-md-4">
    <select name="disponivel" class="form-select">
      <option value="">Disponibilidade</option>
      <option value="1" {% if request.args.get('disponivel') == '1' %}selected{% endif %}>Disponível</option>
      <option value="0" {% if request.args.get('disponivel') == '0' %}selected{% endif %}>Indisponível</option>
    </select>
  </div>
  <div class="col-12 mt-3">
    <button type="submit" class="btn btn-primary w-100">Filtrar</button>
  </div>
</form>

<div class="row">
  {% for item in itens %}
    <div class="col-lg-3 col-md-4 col-sm-6 mb-4">
      <div class="card h-100 shadow-sm border-0 rounded-4">
        <div id="carouselItem{{ item.id }}" class="carousel slide" data-bs-ride="carousel">
          <div class="carousel-inner rounded-top">
            {% if item.imagens %}
              {% for imagem in item.imagens %}
                <div class="carousel-item {% if loop.first %}active{% endif %}">
                  <img src="{{ url_for('static', filename='images/' ~ imagem.caminho) }}"
                       class="d-block w-100 card-img-top img-hover"
                       alt="{{ item.nome }}">
                  {% if imagem.caminho == item.imagem_principal %}
                    <div class="carousel-caption d-none d-md-block">
                      <span class="badge bg-primary">Miniatura</span>
                    </div>
                  {% endif %}
                </div>
              {% endfor %}
            {% else %}
              <div class="carousel-item active">
                <img src="{{ url_for('static', filename='images/default.jpg') }}"
                     class="d-block w-100 card-img-top img-hover" alt="Imagem padrão">
              </div>
            {% endif %}
          </div>

          {% if item.imagens|length > 1 %}
            <button class="carousel-control-prev" type="button" data-bs-target="#carouselItem{{ item.id }}" data-bs-slide="prev">
              <span class="carousel-control-prev-icon"></span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#carouselItem{{ item.id }}" data-bs-slide="next">
              <span class="carousel-control-next-icon"></span>
            </button>
          {% endif %}
        </div>

        <div class="card-body text-center">
          <h5 class="card-title">{{ item.nome }}</h5>
          <p class="card-text">
            <span class="badge {{ 'bg-success' if item.disponivel else 'bg-danger' }}">
              {{ 'Disponível' if item.disponivel else 'Indisponível' }}
            </span>
          </p>
          <div class="d-flex flex-wrap justify-content-center gap-2 mt-2">
            <a href="{{ url_for('item', item_id=item.id) }}" class="btn btn-outline-primary btn-sm">
              <i class="bi bi-eye me-1"></i> Ver detalhes
            </a>
            <a href="{{ url_for('editar_item', item_id=item.id) }}" class="btn btn-outline-warning btn-sm">
              <i class="bi bi-pencil-square me-1"></i> Editar
            </a>
          </div>
        </div>
      </div>
    </div>
  {% endfor %}
</div>
{% endblock %}
